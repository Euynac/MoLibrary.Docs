"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[7002],{5828:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"SignalR/MoSignalR","title":"\u7b80\u4ecb","description":"SignalR\u662f\u5fae\u8f6f\u56e2\u961f\u5bf9WebSocket\u7b49\u652f\u6301\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u53cc\u5411\u901a\u4fe1\u7684\u534f\u8bae\u8fdb\u884c\u5c01\u88c5\u7684\u5e93\uff0c\u8be5\u6a21\u5757\u9488\u5bf9SignalR\u7684\u4f7f\u7528\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\u3002\u652f\u6301\u4ee5\u4e0b\u529f\u80fd\uff1a","source":"@site/docs/SignalR/MoSignalR.md","sourceDirName":"SignalR","slug":"/SignalR/MoSignalR","permalink":"/MoLibrary.Docs/docs/SignalR/MoSignalR","draft":false,"unlisted":false,"editUrl":"https://github.com/Euynac/MoLibrary/tree/main/docs/docs/SignalR/MoSignalR.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u5de5\u4f5c\u5355\u5143UnitOfWork","permalink":"/MoLibrary.Docs/docs/Repository/\u5de5\u4f5c\u5355\u5143UnitOfWork"},"next":{"title":"\u7edf\u4e00\u8fd4\u56de\u6a21\u578bRes","permalink":"/MoLibrary.Docs/docs/Tool/\u7edf\u4e00\u8fd4\u56de\u6a21\u578bRes"}}');var i=r(4848),o=r(8453);const s={},c="\u7b80\u4ecb",a={},l=[{value:"\u672f\u8bed",id:"\u672f\u8bed",level:2},{value:"Hub",id:"hub",level:3},{value:"TIHubOperator",id:"tihuboperator",level:2},{value:"THubOperator",id:"thuboperator",level:2},{value:"TIContract",id:"ticontract",level:2},{value:"THubServer",id:"thubserver",level:2},{value:"TIUser",id:"tiuser",level:2},{value:"Swagger\u6587\u6863\u751f\u6210",id:"swagger\u6587\u6863\u751f\u6210",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"})}),"\n",(0,i.jsx)(n.p,{children:"SignalR\u662f\u5fae\u8f6f\u56e2\u961f\u5bf9WebSocket\u7b49\u652f\u6301\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u53cc\u5411\u901a\u4fe1\u7684\u534f\u8bae\u8fdb\u884c\u5c01\u88c5\u7684\u5e93\uff0c\u8be5\u6a21\u5757\u9488\u5bf9SignalR\u7684\u4f7f\u7528\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\u3002\u652f\u6301\u4ee5\u4e0b\u529f\u80fd\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u5f3a\u7c7b\u578b\u7684\u4f7f\u7528\u65b9\u5f0f"}),"\n",(0,i.jsx)(n.li,{children:"\u96c6\u6210SignalR\u7684Swagger\u63a5\u53e3\u6587\u6863\u751f\u6210"}),"\n",(0,i.jsx)(n.li,{children:"\u63d0\u4f9b\u5f00\u7bb1\u5373\u7528\u7684WebSocket\u8c03\u8bd5\u754c\u9762"}),"\n",(0,i.jsx)(n.li,{children:"\u63d0\u4f9b\u5f00\u7bb1\u5373\u7528\u7684\u57fa\u4e8e\u7528\u6237\u63a8\u9001\u7684\u63a5\u53e3"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u672f\u8bed",children:"\u672f\u8bed"}),"\n",(0,i.jsx)(n.h3,{id:"hub",children:"Hub"}),"\n",(0,i.jsxs)(n.p,{children:["SignalR\u5b9e\u73b0\u4e86\u4e00\u79cdRPC\u673a\u5236\uff0c\u5176\u4e2d\u6d88\u606f\u683c\u5f0f\u53c2\u8003\u5982\u4e0b\uff1a\n",(0,i.jsx)(n.code,{children:'{"arguments":["arg0","arg1"],"invocationId":"2","target":"ReceiveTestMessage","type":1}'})]}),"\n",(0,i.jsxs)(n.p,{children:["\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u79cd\u8be5\u8fde\u63a5\u652f\u6301\u7684\u65b9\u6cd5\u96c6\uff0c\u79f0\u4e3a",(0,i.jsx)(n.code,{children:"Hub"}),"\u3002"]}),"\n",(0,i.jsx)(n.h1,{id:"\u4f7f\u7528\u65b9\u5f0f",children:"\u4f7f\u7528\u65b9\u5f0f"}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f\u5230\u6ce8\u518c\u63a5\u53e3\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'public static void AddMoSignalR<TIHubOperator, THubOperator, TIContract, TIUser>(this IServiceCollection services)\n    where THubOperator : class, IMoHubOperator<TIContract, TIUser>, TIHubOperator\n    where TIHubOperator : class, IMoHubOperator<TIContract, TIUser>\n    where TIContract : IMoHubContract\n    where TIUser : IMoCurrentUser\n    \npublic static void MapMoHub<THubServer>(this IEndpointRouteBuilder endpoints,\n     [StringSyntax("Route")] string pattern, Action<MoHubOptions>? optionAction = null) where THubServer : Hub\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0b\u5206\u522b\u89e3\u91ca\u6240\u9700\u7684\u6cdb\u578b\u7c7b\u578b\u4f5c\u7528"}),"\n",(0,i.jsx)(n.h2,{id:"tihuboperator",children:"TIHubOperator"}),"\n",(0,i.jsx)(n.p,{children:"\u8be5\u7c7b\u578b\u7528\u4e8e\u4e1a\u52a1\u4ee3\u7801\u4e2d\u4f7f\u7528Hub\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6d88\u606f"}),"\n",(0,i.jsx)(n.p,{children:"\u5b9a\u4e49\u65b9\u5f0f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:"public interface IMyHubOperator : IMoHubOperator<IMyContract, IMyCurrentUser>\n{\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u65b9\u5f0f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:"public class DomainEventHandlerForceUserLogout(IMyHubOperator hub)\n    : MoDomainEventHandler<DomainEventHandlerForceUserLogout, EventForceUserLogout>\n{\n    public override async Task HandleEventAsync(EventForceUserLogout eto)\n    {\n        var dict = hub.GetConnectionInfos().Where(p => p.ConnectionTime < eto.TriggerTime && p.ClaimsPrincipal.AsCurrentUser().Username == eto.Username)\n            .Select(p => p.ClaimsPrincipal.AsCurrentUser()).ToList();\n        if (dict.Count <= 0) return;\n        await hub.Users(dict).ClientReceiveForceUserLogout(eto.Reason);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"thuboperator",children:"THubOperator"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"TIHubOperator"}),"\u7684\u5b9e\u73b0\u7c7b\u578b\uff0c\u7528\u4e8e\u670d\u52a1\u6ce8\u518c\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"ticontract",children:"TIContract"}),"\n",(0,i.jsxs)(n.p,{children:["\u5b9a\u4e49RPC\u652f\u6301\u7684\u65b9\u6cd5\u96c6\uff0c\u5efa\u8bae\u547d\u540d\u8fdb\u884c\u5ba2\u6237\u7aef\u4fa7\u53ca\u670d\u52a1\u7aef\u4fa7\u65b9\u6cd5\u7684\u533a\u5206\uff0c\u5efa\u8bae\u547d\u540d\u5f00\u5934",(0,i.jsx)(n.code,{children:"ClientReceive"}),"\u53ca",(0,i.jsx)(n.code,{children:"ClientSend"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"thubserver",children:"THubServer"}),"\n",(0,i.jsx)(n.p,{children:"\u6307\u793a\u5f53\u524dHub\u5b9a\u4e49\uff0c\u4ee5\u53ca\u4f5c\u4e3a\u670d\u52a1\u7aef\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5\u6267\u884c\u8bf7\u6c42\u7684\u5904\u7406\u5165\u53e3\u3002\u53e6\u5916\u4e5f\u662fSwagger\u751f\u6210\u6587\u6863\u7684\u6765\u6e90\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"tiuser",children:"TIUser"}),"\n",(0,i.jsxs)(n.p,{children:["\u7528\u4e8e\u901a\u8fc7",(0,i.jsx)(n.code,{children:"Claim"}),"\u83b7\u53d6\u5f53\u524d\u8fde\u63a5\u7528\u6237\u4fe1\u606f\u7684\u63a5\u53e3\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528",(0,i.jsx)(n.code,{children:"IMoCurrentUser"})]}),"\n",(0,i.jsx)(n.h1,{id:"\u5176\u4ed6\u529f\u80fd\u4ecb\u7ecd",children:"\u5176\u4ed6\u529f\u80fd\u4ecb\u7ecd"}),"\n",(0,i.jsx)(n.h2,{id:"swagger\u6587\u6863\u751f\u6210",children:"Swagger\u6587\u6863\u751f\u6210"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'\n//\u5982\u679c\u5ba2\u6237\u7aef\u901a\u8fc7websocket\u8c03\u7528\uff0c\u5219\u4f1a\u8fdb\u5165\u6b64\u65b9\u6cd5\n[SignalRHub("/signalr", tag: "SignalR\u63a5\u53e3", description: "\u4ec5\u505a\u5c55\u793a\u7528\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u63a5\u53e3\u8c03\u7528\u3002\u8def\u7531/Debug\u4e2d\u6709\u6d4b\u8bd5SignalR\u529f\u80fd\u3002")]\npublic class UnifiedHub(IMoSignalRConnectionManager connectionManager)\n    : MoHubServer<IUnifiedContract>(connectionManager), IUnifiedContract\n{\n    [SignalRMethod(description: "\u63a5\u6536\u822a\u73ed\u66f4\u65b0", summary: "\u63a5\u6536\u822a\u73ed\u66f4\u65b0")]\n    public async Task ClientReceiveFlightUpdate(DtoFlightListData flight, bool isNew, bool isDelete, int filterVersion)\n    {\n        throw new NotImplementedException();\n    }\n\n    [SignalRMethod(description: "\u5ba2\u6237\u7aef\u8bbe\u7f6e\u822a\u73ed\u7b5b\u9009\u6761\u4ef6", summary: "\u5ba2\u6237\u7aef\u8bbe\u7f6e\u822a\u73ed\u7b5b\u9009\u6761\u4ef6")]\n    public async Task ClientSendSetFlightCustomFilter(int version, QueryGetFlightList filter)\n    {\n        var info = connectionManager.GetConnectionInfo(Context.ConnectionId);\n        info?.SaveState(new StateClientSetFlightCustomFilter\n        {\n            CustomFilter = filter,\n            Version = version\n        });\n    }\n}\n\n'})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var t=r(6540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);